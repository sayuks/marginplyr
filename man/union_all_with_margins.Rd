% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/union_all_with_margins.R
\name{union_all_with_margins}
\alias{union_all_with_margins}
\title{\verb{UNION ALL} with margins}
\usage{
union_all_with_margins(
  .data,
  .margins = NULL,
  .without_all = NULL,
  .with_all = NULL,
  .margin_name = "(all)",
  .sort = FALSE
)
}
\arguments{
\item{.data}{A data frame or lazy table.
\itemize{
\item Lazy tables created by \code{{arrow}} does not work.
If you want to work with it, it is an easy way to convert to
a duckdb back-end using \code{arrow::to_duckdb()} in advance.
}}

\item{.margins}{<\code{\link[=dplyr_tidy_select]{tidy-select}}> Grouping columns which
margins are calculated, starting from the highest parent of the hierarchy.}

\item{.without_all}{<\code{\link[=dplyr_tidy_select]{tidy-select}}> Additional group
variables without hierarchy to which \code{.margin_name} will \emph{NOT} be added.}

\item{.with_all}{<\code{\link[=dplyr_tidy_select]{tidy-select}}> Additional group
variables without hierarchy to which \code{.margin_name} will be added.}

\item{.margin_name}{A string representing margin name
(Defaults to \code{"(all)"}). \code{NA_character_} is also allowed.}

\item{.sort}{A Logical (defaults to \code{is.data.frame(.data)}).
If \code{TRUE}, sort the result by the column order
specified in \code{.without_all} and \code{.margins} and \code{.with_all}.
* This is because pipelines using lazy tables should perform the
SQL \verb{ORDER BY} as last as possible.
* As a result of sorting, in the case of lazy tables,
\code{NA} may come first, unlike R.
* See \href{https://dbplyr.tidyverse.org/reference/arrange.tbl_lazy.html}{\code{arrange()} documentation of \code{{dbplyr}}}
for details.}
}
\value{
A data frame. If \code{.data} is a lazy table,
the output is also a lazy table.
}
\description{
This function considers each margin (such as total) as a new category,
duplicate the rows and merge them vertically (like \verb{UNION ALL} in SQL).
See \href{https://sayuks.github.io/withmargins/vignettes/get_started.html}{Get started}
for more details.
}
\details{
\itemize{
\item Consider each margin as a new category, duplicate the rows and merge them
vertically (like \verb{UNION ALL} in SQL).
\item The use of arguments in common with \code{summarize_with_margins()} is the same
as for it.
\item \strong{Be aware that the number of rows can be huge.}
}
}
\section{About returned data}{

\itemize{
\item Missing values are kept as missing.
\item The order of the columns is as follows from left to right:
\code{.without_all}, \code{.margins}, \code{.with_all} and the remaining columns.
\item Column types specified with \code{.margins} or \code{.with_all}:
\itemize{
\item Columns that are not originally factor or character
(e.g. numeric, integer, logical, .etc) are converted to characters.
This is required to add the \code{.margin_name} category.
\item Originally the factor column (assuming a local data frame):
\itemize{
\item Remains as factor. (If ordered, remains as ordered).
\item The level of the factor depends on the case:
\itemize{
\item If \code{.margin_name} is \emph{\strong{NOT}} a \code{NA_character}
(such as \code{"(all)"}):
\itemize{
\item \code{.margin_name} is added to the
beginning of the level of the factor.
}
\item If \code{.margin_name} is a \code{NA_character}:
\itemize{
\item If the column has \verb{<NA>} in the level:
\itemize{
\item Error occurs. Because, although the values with level
\verb{<NA>} are not equal to \code{NA_character_}, they will be
identical and indistinguishable when merging
\code{NA_character_} as a new category.
}
\item If the column does not have \verb{<NA>} in the level:
\itemize{
\item Just keeps the original level of factor.
\verb{<NA>} is not included in the level.
This is consistent with the default
\code{\link[=factor]{factor()}} behavior (\code{exclude = NA}).
}
}
}
}
}
}
}

\examples{
union_all_with_margins(
  mtcars,
  .margins = c(cyl, vs),
  .without_all = am,
  .with_all = gear
)
}
\references{
\itemize{
\item Online documentation: \href{https://sayuks.github.io/withmargins/vignettes/get_started.html}{Get started}
}
}
\seealso{
Other summarize and expand data with margins: 
\code{\link{nest_by_with_margins}()},
\code{\link{nest_with_margins}()},
\code{\link{summarize_with_margins}()}
}
\concept{summarize and expand data with margins}
