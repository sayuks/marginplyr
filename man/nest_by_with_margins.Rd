% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/nest_by_with_margins.R
\name{nest_by_with_margins}
\alias{nest_by_with_margins}
\title{Works like \code{dplyr::nest_by()} with margins}
\usage{
nest_by_with_margins(
  .data,
  .margins = NULL,
  .without_all = NULL,
  .with_all = NULL,
  .margin_name = "(all)",
  .sort = TRUE,
  .key = "data",
  .keep = FALSE
)
}
\arguments{
\item{.data}{A data frame.}

\item{.margins}{<\code{\link[=dplyr_tidy_select]{tidy-select}}> Grouping columns which
margins are calculated, starting from the highest parent of the hierarchy.}

\item{.without_all}{<\code{\link[=dplyr_tidy_select]{tidy-select}}> Additional group
variables without hierarchy to which \code{.margin_name} will \emph{NOT} be added.}

\item{.with_all}{<\code{\link[=dplyr_tidy_select]{tidy-select}}> Additional group
variables without hierarchy to which \code{.margin_name} will be added.}

\item{.margin_name}{A string representing margin name
(Defaults to \code{"(all)"}). \code{NA_character_} is also allowed.}

\item{.sort}{A Logical (default to \code{TRUE}). If \code{TRUE}, sort the result
by the column order specified in \code{.without_all} and \code{.margins} and
\code{.with_all}.}

\item{.key}{Name of the list column}

\item{.keep}{Should the grouping columns be kept in the list column.}
}
\value{
A data frame.
}
\description{
This function considers each margin (such as total) as a new category,
works like \code{\link[dplyr:nest_by]{dplyr::nest_by()}}.
See \href{https://sayuks.github.io/withmargins/vignettes/get_started.html}{Get started}
for more details.
}
\details{
\itemize{
\item Works like \verb{dplyr::nest_by(<data>, dplyr::pick(\{\{ .without_all \}\} , \{\{ .margins \}\} , \{\{ .with_all \}\})}
on the result of \code{union_all_with_margins()}. The result is a row-wise
data frame grouped by row.
\item Only works for a local data frame.
}
}
\section{About returned data}{

\itemize{
\item Missing values are kept as missing.
\item The order of the columns is as follows from left to right:
\code{.without_all}, \code{.margins}, \code{.with_all} and the remaining columns.
\item Column types specified with \code{.margins} or \code{.with_all}:
\itemize{
\item Columns that are not originally factor or character
(e.g. numeric, integer, logical, .etc) are converted to characters.
This is required to add the \code{.margin_name} category.
\item Originally the factor column (assuming a local data frame):
\itemize{
\item Remains as factor. (If ordered, remains as ordered).
\item The level of the factor depends on the case:
\itemize{
\item If \code{.margin_name} is \emph{\strong{NOT}} a \code{NA_character}
(such as \code{"(all)"}):
\itemize{
\item \code{.margin_name} is added to the
beginning of the level of the factor.
}
\item If \code{.margin_name} is a \code{NA_character}:
\itemize{
\item If the column has \verb{<NA>} in the level:
\itemize{
\item Error occurs. Because, although the values with level
\verb{<NA>} are not equal to \code{NA_character_}, they will be
identical and indistinguishable when merging
\code{NA_character_} as a new category.
}
\item If the column does not have \verb{<NA>} in the level:
\itemize{
\item Just keeps the original level of factor.
\verb{<NA>} is not included in the level.
This is consistent with the default
\code{\link[=factor]{factor()}} behavior (\code{exclude = NA}).
}
}
}
}
}
}
}

\examples{
nest_by_with_margins(
  mtcars,
  .margins = c(cyl, vs),
  .without_all = am,
  .with_all = gear
)
}
\references{
\itemize{
\item Online documentation: \href{https://sayuks.github.io/withmargins/vignettes/get_started.html}{Get started}
}
}
\seealso{
Other summarize and expand data with margins: 
\code{\link{nest_with_margins}()},
\code{\link{summarize_with_margins}()},
\code{\link{union_all_with_margins}()}
}
\concept{summarize and expand data with margins}
